// @codekit-append "_scripts.js"

//$("#menuBtn").swap();

function navIn(){
  var d= 0;
  $('nav a').each(function() {
      $(this).delay(d).transition({
        opacity: 1,
        padding: '5px 0',
      },300);
      d += 200;
  });

    $("#splash--wrapper").delay(300).addClass('blurred');


}

function navOut(){
  var d= 0;
  $($("nav a").get().reverse()).each(function() {
      $(this).delay(d).transition({
        opacity: 0,
        padding: '0',
      },300);
      d += 200;
  });
    $("#splash--wrapper").removeClass('blurred');;


}

var $menu = $(".toggle");

//$(".toggle").swap();

$("#menuBtn").on("activate.swap", function(){
  navIn();
});

$("#menuBtn").on("deactivate.swap", function(){
  navOut();
});

$("#modal-nav a").swap();

$('.boom').on("activate.swap", function(){
  console.log('boom');
});

  var $content,
      $deferred;

  $(document).ready(function() {
    // Bind ASAP events
    $(window).on("request.asap", pageRequested)
         .on("progress.asap", pageLoadProgress)
         .on("load.asap", pageLoaded)
         .on("render.asap", pageRendered)
         .on("error.asap", pageLoadError);

    $content = $("#content");

    // Init ASAP
    $.asap({
      cache: true,
      selector: "a",
      transitionOut: function() {
        if ($deferred) {
          $deferred.reject();
        }

        $deferred = $.Deferred();

        $content.animate({ opacity: 0 }, 1000, function() {
          console.log("Animate complete");

          $deferred.resolve();
        });

        return $deferred;
      }
    });

    // Remember to init first page
    pageRendered();
  });

  function pageRequested(e) {
    // update state to reflect loading
    console.log("Request new page");
  }

  function pageLoadProgress(e, percent) {
    // update progress to reflect loading
    console.log("New page load progress", percent);
  }

  function pageLoaded(e) {
    // unbind old events and remove plugins
    console.log("Destroy old page");
  }

  function pageRendered(e) {
    // bind new events and initialize plugins
    console.log("Render new page");

    $content.animate({ opacity: 1 }, 1000);
  }

  function pageLoadError(e, error) {
    // watch for load errors
    console.warn("Error loading page: ", error);
  }

// @codekit-prepend "_modalnav.js"
// @codekit-prepend "_pronto.js"

$(function(){

  function about(){
    $("#quotes").carousel({
      show: 1,
      autoAdvance: true,
      pagination: true,
      controls: false
    });
    $("#brands").carousel({
      show: {
        "320px" : 1,
        "960px" : 4
      },
      infinite: true,
      controls: false,
    });
  }
  about();
  $("select").dropdown();
  $("#splash--nav").navigation({
    labels: {
      closed: '',
      open: '',
    }
  });

  // External Links New Window

  $('a').each(function() {
   var a = new RegExp('/' + window.location.host + '/');
   if(!a.test(this.href)) {
       $(this).click(function(event) {
           event.preventDefault();
           event.stopPropagation();
           window.open(this.href, '_blank');
       });
   }
});

  setTimeout(function(){
    $('#splash--video').animate({
      opacity: 1,
    }, 1200);
  }, 2000);

  $('.popup').magnificPopup({
    type: 'inline',
    preloader: false,
    focus: '#name',
    mainClass: 'my-mfp-slide-bottom',

    // When elemened is focused, some mobile browsers in some cases zoom in
    // It looks not nice, so we disable it:
    callbacks: {
      beforeOpen: function() {
        if($(window).width() < 700) {
          this.st.focus = false;
        } else {
          this.st.focus = '#name';
        }

      },
      open: function() {
        $("#quotes").carousel({
      show: 1,
      autoAdvance: true,
      pagination: false,
    });
    $("#brands").carousel();
      }
    }
  });

  $('.modal').magnificPopup({
    type: 'ajax',
    mainClass: 'content-page',
    callbacks : {
      parseAjax: function(mfpResponse) {
        mfpResponse.data = $(mfpResponse.data).find('#content');

      },
      ajaxContentAdded: function() {
        about();
      }
    },
    //alignTop: center,
    overflowY: 'scroll' // as we know that popup content is tall we set scroll overflow by default to avoid jump
  });

  // $(window).load(function () {
  //       // retrieved this line of code from http://dimsemenov.com/plugins/magnific-popup/documentation.html#api
  //       $.magnificPopup.open({
  //           items: {
  //             src: '#splash--signup',
  //             type: 'inline'
  //           },
  //           preloader: false,
  //           mainClass: 'my-mfp-slide-bottom',

  //         // You may add options here, they're exactly the same as for $.fn.magnificPopup call
  //         // Note that some settings that rely on click event (like disableOn or midClick) will not work here
  //       }, 0);
  //   });


});

